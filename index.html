<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ë´‰ë‹´ì¤‘ ì½”ë”© ë™ì•„ë¦¬</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
            background: linear-gradient(to bottom right, #e0e7ff, #ffffff);
            color: #1f2937;
        }
        .container {
            max-width: 960px;
            margin: 50px auto;
            padding: 0 20px;
            text-align: center;
        }
        .button {
            background-color: #6366f1;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 8px;
            display: inline-block;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .button:hover {
            background-color: #4f46e5;
            transform: translateY(-2px);
        }
        .tab-button {
            padding: 12px 24px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #e5e7eb;
            color: #374151;
            border: 2px solid #cbd5e1;
            border-radius: 25px;
            margin: 0 8px;
            transition: all 0.3s ease;
        }
        .tab-button:hover {
            background-color: #d1d5db;
            transform: scale(1.05);
        }
        .tab-button.active {
            background-color: #6366f1;
            color: white;
            border-color: #6366f1;
        }
        .tab-content {
            display: none;
            text-align: left;
            padding: 32px;
            background-color: #f9fafb;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            margin-top: 30px;
            transition: all 0.4s ease;
        }
        .tab-content.active {
            display: block;
        }
        .hidden { display: none; }
        .animate-bounce-on-hover:hover {
            animation: shake 0.6s ease-in-out;
        }
        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(-5deg); }
            75% { transform: rotate(3deg); }
            100% { transform: rotate(0deg); }
        }

        .lesson-set.locked-preview {
        position: relative;
        filter: blur(2px);
        opacity: 0.5;
        pointer-events: none;
      }

      .lesson-set.locked-preview::after {
        content: "ğŸ”’ ì ê¸´ ì½˜í…ì¸  (ë‹¤ìŒ ë‹¨ê³„ ë¯¸ë¦¬ë³´ê¸°)";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.85);
        padding: 10px 16px;
        border-radius: 8px;
        font-weight: bold;
        color: #1f2937;
        z-index: 10;
        font-size: 13px;
        text-align: center;
      }
    </style>

</head>
<body>
<div id="login-screen" class="max-w-md mx-auto bg-white p-8 rounded shadow">
    <h1 class="text-2xl font-bold mb-4 text-blue-800">ğŸ” ë¡œê·¸ì¸</h1>
    <input type="text" id="login-id" placeholder="ID ì…ë ¥" class="w-full border p-2 rounded mb-3"/>
    <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" class="w-full border p-2 rounded mb-4"/>
    <button onclick="loginLocal()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">ë¡œê·¸ì¸</button>
    <p id="login-error" class="text-red-600 mt-2 hidden">âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
</div>

<div id="main-content" class="hidden">
    <p id="welcome-text" class="text-right text-sm text-gray-600 mb-1 pr-6"></p>
    <div id="admin-shortcut" class="text-right pr-6 mb-4 hidden">
        <a href="secret.html" target="_blank" class="inline-block bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded text-sm">
            âœ… ê´€ë¦¬ì í˜ì´ì§€ ë°”ë¡œê°€ê¸°
        </a>
    </div>
    <p id="welcome-text" class="text-right text-sm text-gray-600 mb-4 pr-6"></p>


    <div class="container">
        <h1 class="text-4xl font-bold mb-8 text-blue-900 drop-shadow-lg">íŒŒì´ì¬ í•™ìŠµ ì‚¬ì´íŠ¸</h1>

        <div class="flex flex-wrap justify-center gap-4 mb-8">
            <button class="tab-button active" onclick="openTab(event, 'home')">í™ˆ</button>
            <button class="tab-button" onclick="openTab(event, 'python')">íŒŒì´ì¬</button>
            <button class="tab-button" onclick="openTab(event, 'quiz')">íŒŒì´ì¬ ë¬¸ì œ</button>
            <a href="submit.html" class="tab-button">ì œì¶œ</a>
        </div>


        <button onclick="logoutSupabase()" class="fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 shadow-lg z-50">
            ğŸ”“ ë¡œê·¸ì•„ì›ƒ
        </button>

        <div id="home" class="tab-content active bg-white rounded-xl shadow-lg p-8">

            <div class="bg-white shadow rounded-xl p-6 mb-6 mx-auto max-w-2xl">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-blue-700 cursor-pointer" onclick="scrollToCalendar()">ğŸ“… ì¶œì„ ì²´í¬</h2>
                    <button onclick="toggleCalendar()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded">
                        ë‹¬ë ¥ ë³´ê¸°
                    </button>
                </div>

                <div id="attendance-status" class="text-green-600 font-medium mb-3"></div>

                <div id="calendar-container" class="hidden transition-all duration-500">
                    <div id="calendar" class="bg-gray-50 p-4 rounded shadow">
                        <h3 class="text-base font-semibold mb-3 text-gray-700">ğŸ—“ï¸ ë‚˜ì˜ ì¶œì„ ë‹¬ë ¥</h3>
                        <div id="calendar-grid" class="grid grid-cols-7 gap-2 text-center text-sm text-gray-800">
                            <div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="bg-white shadow rounded-xl p-6 mb-6 mx-auto max-w-2xl">
                <h2 class="text-xl font-bold text-blue-700 mb-2">ğŸ† ë‚˜ì˜ ë ˆë²¨</h2>
                <p id="xp-status" class="text-lg font-semibold"></p>
                <button id="levelShopBtn" class="text-sm bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
                ë ˆë²¨ ìƒì 
                </button>
            </div>
            <!-- ë ˆë²¨ í‘œì‹œ + ë²„íŠ¼ -->
             <!-- ìƒì  ëª¨ë‹¬ -->
            <div id="levelShopModal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50">
              <div class="bg-white w-96 p-6 rounded-xl shadow-lg text-center animate-scaleIn">
                <h2 class="text-xl font-semibold mb-3">ğŸ ë ˆë²¨ ìƒì </h2>
                <p class="text-sm text-gray-600 mb-4">XPë¥¼ ì‚¬ìš©í•´ ì•„ì´í…œì„ êµ¬ë§¤í•˜ì„¸ìš”!</p>

                <ul class="text-left text-sm list-disc pl-6 space-y-3">
                  <ul>
                    <li>
                      <li>
                      1ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv1, 50XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_1"
                        data-required=""
                        data-cost="50">êµ¬ë§¤</button>
                    </li>

                    <li>
                      2ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv2, 70XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_2"
                        data-required="unlock_set_1"
                        data-cost="70">êµ¬ë§¤</button>
                    </li>

                    <li>
                      3ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv3, 100XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_3"
                        data-required="unlock_set_2"
                        data-cost="100">êµ¬ë§¤</button>
                    </li>

                    <li>
                      4ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv4, 130XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_4"
                        data-required="unlock_set_3"
                        data-cost="130">êµ¬ë§¤</button>
                    </li>

                    <li>
                      5ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv5, 160XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_5"
                        data-required="unlock_set_4"
                        data-cost="160">êµ¬ë§¤</button>
                    </li>

                    <li>
                      6ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv6, 200XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_6"
                        data-required="unlock_set_5"
                        data-cost="200">êµ¬ë§¤</button>
                    </li>

                    <li>
                      7ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv7, 240XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_7"
                        data-required="unlock_set_6"
                        data-cost="240">êµ¬ë§¤</button>
                    </li>

                    <li>
                      8ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv8, 280XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_8"
                        data-required="unlock_set_7"
                        data-cost="280">êµ¬ë§¤</button>
                    </li>

                    <li>
                      9ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv9, 320XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_9"
                        data-required="unlock_set_8"
                        data-cost="320">êµ¬ë§¤</button>
                    </li>

                    <li>
                      10ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv10, 360XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_10"
                        data-required="unlock_set_9"
                        data-cost="360">êµ¬ë§¤</button>
                    </li>

                    <li>
                      11ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv11, 400XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_11"
                        data-required="unlock_set_10"
                        data-cost="400">êµ¬ë§¤</button>
                    </li>

                    <li>
                      12ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv12, 450XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_12"
                        data-required="unlock_set_11"
                        data-cost="450">êµ¬ë§¤</button>
                    </li>

                    <li>
                      13ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv13, 500XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_13"
                        data-required="unlock_set_12"
                        data-cost="500">êµ¬ë§¤</button>
                    </li>

                    <li>
                      14ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv14, 550XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_14"
                        data-required="unlock_set_13"
                        data-cost="550">êµ¬ë§¤</button>
                    </li>

                    <li>
                      15ë‹¨ê³„ ì§„ë„ ì—´ê¸° (Lv15, 600XP)
                      <button class="buy-btn ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded"
                        data-key="unlock_set_15"
                        data-required="unlock_set_14"
                        data-cost="600">êµ¬ë§¤</button>
                    </li>

                  </ul>


                  

                </ul>

                <button id="closeShopBtn" class="mt-5 px-4 py-2 bg-gray-300 hover:bg-gray-400 text-sm rounded">ë‹«ê¸°</button>
              </div>
            </div>

            <!-- ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ -->
            <style>
            @keyframes scaleIn {
              0% { transform: scale(0.95); opacity: 0; }
              100% { transform: scale(1); opacity: 1; }
            }
            .animate-scaleIn {
              animation: scaleIn 0.3s ease-out;
            }
            </style>




            <div class="bg-white shadow rounded-xl p-6 mb-6 mx-auto max-w-2xl">
                <h2 class="text-xl font-bold text-blue-700 mb-2">ğŸ“ ë‚˜ë§Œì˜ ë©”ëª¨ì¥</h2>
                <textarea id="memo" placeholder="ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ì„ ì •ë¦¬í•´ ë³´ì„¸ìš”." class="w-full p-3 border rounded"></textarea>
            </div>
        </div>


        <div id="python" class="tab-content">
            <h2 class="text-2xl font-bold mb-4 text-blue-700">íŒŒì´ì¬ í•™ìŠµ</h2>
            <p>íŒŒì´ì¬ì˜ ê¸°ë³¸ ê°œë…ê³¼ ë‹¤ì–‘í•œ ë§í¬ë“¤ì„ í†µí•´ ì‹¤ìŠµì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <a href="print.html" class="button">print()</a>
            <div data-set="unlock_set_1" class="lesson-set">
              <a href="python1.html" class="button">1-1. ê³„ì‚° ë°°ìš°ê¸°</a>
              <a href="python2.html" class="button">1-2. íƒ€ì… ë°°ìš°ê¸°</a>
              <a href="python3.html" class="button">1-3. ìˆ«ì ê³„ì‚°</a>
            </div>

            <div data-set="unlock_set_2" class="lesson-set">
              <a href="python4.html" class="button">2-1. ë³€ìˆ˜ë€?</a>
              <a href="python2-2.html" class="button">2-2. ë³€ìˆ˜ ë‹¤ë£¨ê¸°</a>
              <a href="python2-3.html" class="button">2-3. ë³€ìˆ˜ì™€ ê³„ì‚°</a>
              <a href="python2-4.html" class="button">2-4. ê°’ ì…ë ¥ ë°›ê¸°</a>
              <a href="python2-5.html" class="button">2-5. ë‹¤ì–‘í•œ ì¶œë ¥</a>
              <a href="python2-6.html" class="button">2-6. ë³€ìˆ˜ ì˜ˆì œ</a>
            </div>

            <div data-set="unlock_set_3" class="lesson-set">
              <a href="python3-1.html" class="button">3-1. ê°’ ì…ë ¥ ë°›ê¸°</a>
              <a href="python3-2.html" class="button">3-2. is, in, type</a>
              <a href="python3-3.html" class="button">3-3. bool ë³€í™˜</a>
              <a href="python3-4.html" class="button">3-4. ë…¼ë¦¬ ì—°ì‚°ì</a>
              <a href="python3-5.html" class="button">3-5. ë¹„êµí•˜ê¸° ì˜ˆì œ</a>
            </div>

            <div data-set="unlock_set_3" class="lesson-set">
              <a href="python4-1.html" class="button">4-1. í•¨ìˆ˜ì˜ í˜¸ì¶œ</a>
              <a href="python4-2.html" class="button">4-2. í•¨ìˆ˜ì˜ ë°˜í™˜</a>
              <a href="python4-3.html" class="button">4-3. í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜
              <a href="python4-4.html" class="button">4-4. í•¨ìˆ˜ì˜ ì‚¬ìš©</a>
              <a href="python4-5.html" class="button">4-5. í•¨ìˆ˜ ì˜ˆì œ</a>
            </div>

            <div data-set="unlock_set_5" class="lesson-set">
              
            </div>
            <div data-set="unlock_set_6" class="lesson-set">
              
            </div>
            <div data-set="unlock_set_7" class="lesson-set">
              
            </div>
            <div data-set="unlock_set_8" class="lesson-set">
              
            </div>
            <div data-set="unlock_set_9" class="lesson-set">
              
            </div>
            <div data-set="unlock_set_10" class="lesson-set">
              
            </div>
            <div data-set="unlock_set_11" class="lesson-set">
              
            </div>
            <div data-set="unlock_set_12" class="lesson-set">
              
            </div>
            <div data-set="unlock_set_13" class="lesson-set">
              
            </div>
            <div data-set="unlock_set_14" class="lesson-set">
              
            </div>
            <div data-set="unlock_set_15" class="lesson-set">
              
            </div>


        </div>
        <div id="quiz" class="tab-content">
            <h2 class="text-2xl font-bold mb-4 text-blue-700">íŒŒì´ì¬ ë¬¸ì œ</h2>

            <div data-set="unlock_set_1" class="lesson-set">
              <a href="python.hw1.html" class="button">1-1. ë‹¤ì´ì•„ëª¬ë“œ ì¶œë ¥</a>
            </div>

            <div data-set="unlock_set_2" class="lesson-set">
              <a href="python.hw2-1.html" class="button">2-1. ëª«ê³¼ ë‚˜ë¨¸ì§€</a>
              <a href="python.hw2-2.html" class="button">2-2. ì œê³± ê³„ì‚°í•˜ê¸°</a>
              <a href="python.hw2-3.html" class="button">2-3. ì›ê°€ì™€ ì •ê°€</a>
              <a href="python.hw2-4.html" class="button">2-4. ì†Œê¸ˆë¬¼ ë†ë„ êµ¬í•˜ê¸°</a>
              <a href="python.hw2-5.html" class="button">2-5. ì†Œê¸ˆë¬¼ ë†ë„ êµ¬í•˜ê¸° 2</a>
              <a href="python.hw2-6.html" class="button">2-6. í‰ê·  ì†ë ¥ êµ¬í•˜ê¸°</a>
              <a href="python.hw2-7.html" class="button">2-7. ë§ì•„í†¤ ê¿ˆì˜ ê¸°ë¡</a>
            </div>
        </div>
    </div>
</div>
<script type="module" src="script.js"></script>
<script src="local-script.js"></script>
<script>
let purchasedItems = new Set();

// êµ¬ë§¤í•œ í•­ëª© ë¶ˆëŸ¬ì˜¤ê¸°
async function loadPurchasedItems() {
  const userId = localStorage.getItem("userId");
  if (!userId) return;

  const { data, error } = await supabase
    .from("club_xp_items")
    .select("item_key")
    .eq("user_id", userId);

  if (error) {
    console.error("âŒ êµ¬ë§¤ ê¸°ë¡ ì¡°íšŒ ì‹¤íŒ¨:", error.message);
    return;
  }

  purchasedItems = new Set(data.map(d => d.item_key));
  updateBuyButtons();
  updateLessonVisibility(); // ì—¬ê¸°ì„œ ì§„ë„ ë²„íŠ¼ì„ ë³´ì´ê²Œ ë§Œë“¦
}
window.loadPurchasedItems = loadPurchasedItems;

function updateLessonVisibility() {
  const allSets = Array.from(document.querySelectorAll(".lesson-set"));
  let foundNext = false;

  allSets.forEach(setEl => {
    const requiredKey = setEl.dataset.set;
    const unlocked = purchasedItems.has(requiredKey);

    // ê¸°ë³¸ ìƒíƒœ: ìˆ¨ê¹€
    setEl.classList.add("hidden");
    setEl.classList.remove("locked-preview");

    if (unlocked) {
      // êµ¬ë§¤í•œ ë‹¨ê³„ëŠ” ì •ìƒ í‘œì‹œ
      setEl.classList.remove("hidden");
    } else if (!foundNext) {
      // ì•„ì§ ì ê¸ˆì´ì§€ë§Œ ë°”ë¡œ ë‹¤ìŒ ë‹¨ê³„ëŠ” ë¯¸ë¦¬ë³´ê¸°
      setEl.classList.remove("hidden");
      setEl.classList.add("locked-preview");
      foundNext = true; // ì´í›„ ë‹¨ê³„ëŠ” ìˆ¨ê¹€ ìœ ì§€
    }
  });
}



// ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
function updateBuyButtons() {
  document.querySelectorAll(".buy-btn").forEach(btn => {
    const key = btn.dataset.key;
    const requiredKey = btn.dataset.required;
    const cost = parseInt(btn.dataset.cost);
    const alreadyPurchased = purchasedItems.has(key);
    const requiredPurchased = !requiredKey || purchasedItems.has(requiredKey);

    const disabled = !requiredPurchased || window.currentXP < cost || alreadyPurchased;

    btn.disabled = disabled;
    btn.classList.toggle("opacity-50", disabled);
    btn.innerText = alreadyPurchased ? "êµ¬ë§¤ ì™„ë£Œ" : "êµ¬ë§¤";
  });
}


// êµ¬ë§¤ ì²˜ë¦¬
document.querySelectorAll(".buy-btn").forEach(btn => {
  btn.addEventListener("click", async () => {
    const key = btn.dataset.key;
    const cost = parseInt(btn.dataset.cost);
    const userId = localStorage.getItem("userId");

    if (purchasedItems.has(key)) {
      alert("â— ì´ë¯¸ êµ¬ë§¤í•œ ì•„ì´í…œì…ë‹ˆë‹¤.");
      return;
    }

    const { data } = await supabase
      .from("club_xp")
      .select("*")
      .eq("user_id", userId)
      .eq("club_name", "ì½”ë”©ë™ì•„ë¦¬");

    if (data.length > 0) {
      const current = data[0].xp;
      const newXP = current - cost;

      await supabase
        .from("club_xp")
        .update({ xp: newXP })
        .eq("id", data[0].id);

      await supabase
        .from("club_xp_items")
        .insert([{ user_id: userId, item_key: key, purchased: true }]);

      await updateXp(userId);     // XP UI ê°±ì‹ 
      await loadPurchasedItems(); // ë²„íŠ¼ ë‹¤ì‹œ ì²´í¬
      alert("âœ… ì•„ì´í…œì„ ì„±ê³µì ìœ¼ë¡œ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!");
    }
  });
});

// ìƒì  ì—´ë¦´ ë•Œ ì‹¤í–‰
document.getElementById("levelShopBtn").addEventListener("click", async () => {
  document.getElementById("levelShopModal").classList.remove("hidden");
  document.getElementById("levelShopModal").classList.add("flex");
  await loadPurchasedItems();
});

document.getElementById("closeShopBtn").addEventListener("click", () => {
  document.getElementById("levelShopModal").classList.add("hidden");
  document.getElementById("levelShopModal").classList.remove("flex");
});


</script>



</body>
</html>