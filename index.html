<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CodingOn - ë´‰ë‹´ì¤‘ ì½”ë”©  ë™ì•„ë¦¬</title>
  <link rel="icon" href="/logo.png" type="image/png" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
      background: linear-gradient(to bottom right, #e0e7ff, #ffffff);
      color: #1f2937;
    }

    .container {
      max-width: 960px;
      margin: 50px auto;
      padding: 0 20px;
      text-align: center;
    }

    .button {
      background-color: #6366f1;
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      margin: 8px;
      display: inline-block;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .button:hover {
      background-color: #4f46e5;
      transform: translateY(-2px);
    }

    .tab-button {
      padding: 12px 24px;
      font-size: 1.1em;
      cursor: pointer;
      background-color: #e5e7eb;
      color: #374151;
      border: 2px solid #cbd5e1;
      border-radius: 25px;
      margin: 0 8px;
      transition: all 0.3s ease;
    }

    .tab-button:hover {
      background-color: #d1d5db;
      transform: scale(1.05);
    }

    .tab-button.active {
      background-color: #6366f1;
      color: white;
      border-color: #6366f1;
    }

    .tab-content {
      display: none;
      text-align: left;
      padding: 32px;
      background-color: #f9fafb;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      margin-top: 30px;
      transition: all 0.4s ease;
    }

    .tab-content.active {
      display: block;
    }

    .hidden {
      display: none;
    }

    .animate-bounce-on-hover:hover {
      animation: shake 0.6s ease-in-out;
    }

    @keyframes shake {
      0% {
        transform: rotate(0deg);
      }

      25% {
        transform: rotate(5deg);
      }

      50% {
        transform: rotate(-5deg);
      }

      75% {
        transform: rotate(3deg);
      }

      100% {
        transform: rotate(0deg);
      }
    }

    .lesson-set.locked-preview {
      position: relative;
      opacity: 1;
      filter: none;
      pointer-events: auto;
    }

    .lesson-set.locked-preview::after {
      display: none;
    }

    @keyframes scaleIn {
      0% {
        transform: scale(0.95);
        opacity: 0;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .animate-scaleIn {
      animation: scaleIn 0.3s ease-out;
    }
  </style>

</head>

<body>

  <div id="login-screen" class="max-w-md mx-auto bg-white p-8 rounded shadow">
    <h1 class="text-2xl font-bold mb-4 text-blue-800">ğŸ” ë¡œê·¸ì¸</h1>
    <input type="text" id="login-id" placeholder="ID ì…ë ¥" class="w-full border p-2 rounded mb-3" />
    <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" class="w-full border p-2 rounded mb-4" />
    <button onclick="loginLocal()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">ë¡œê·¸ì¸</button>
    <p id="login-error" class="text-red-600 mt-2 hidden">âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
  </div>

  <div id="main-content" class="hidden">
    <p id="welcome-text" class="text-right text-sm text-gray-600 mb-1 pr-6"></p>
    <div id="admin-shortcut" class="text-right pr-6 mb-4 hidden">
      <a href="secret.html" target="_blank"
        class="inline-block bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded text-sm">
        âœ… ê´€ë¦¬ì í˜ì´ì§€ ë°”ë¡œê°€ê¸°
      </a>
    </div>
    <p id="welcome-text" class="text-right text-sm text-gray-600 mb-4 pr-6"></p>


    <div class="container">
      <h1 class="text-4xl font-bold mb-8 text-blue-900 drop-shadow-lg">íŒŒì´ì¬ í•™ìŠµ ì‚¬ì´íŠ¸</h1>

      <div class="flex flex-wrap justify-center gap-4 mb-8">
        <button class="tab-button active" onclick="openTab(event, 'home')">í™ˆ</button>
        <button class="tab-button" onclick="openTab(event, 'python')">íŒŒì´ì¬</button>
        <button class="tab-button" onclick="openTab(event, 'quiz')">íŒŒì´ì¬ ë¬¸ì œ</button>
        <a href="submit.html" class="tab-button">ì œì¶œ</a>
      </div>


      <button onclick="logoutSupabase()"
        class="fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 shadow-lg z-50">
        ğŸ”“ ë¡œê·¸ì•„ì›ƒ
      </button>

      <div id="home" class="tab-content active bg-white rounded-xl shadow-lg p-8">

        <div class="bg-white shadow rounded-xl p-6 mb-6 mx-auto max-w-2xl">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold text-blue-700">ğŸ“… ì¶œì„ ì²´í¬</h2>
            <div class="space-x-2">
              <button onclick="checkAttendance(localStorage.getItem('userId'))"
                class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                ì¶œì„ ì²´í¬í•˜ê¸°
              </button>
              <button onclick="toggleCalendar()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                ë‹¬ë ¥ ë³´ê¸°
              </button>
            </div>
          </div>


          <div id="attendance-status" class="text-green-600 font-medium mb-3"></div>

          <div id="calendar-container" class="hidden transition-all duration-500">
            <div id="calendar" class="bg-gray-50 p-4 rounded shadow">
              <h3 class="text-base font-semibold mb-3 text-gray-700">ğŸ—“ï¸ ë‚˜ì˜ ì¶œì„ ë‹¬ë ¥</h3>
              <div id="calendar-grid" class="grid grid-cols-7 gap-2 text-center text-sm text-gray-800"></div>
            </div>
          </div>
        </div>


        <div class="bg-white shadow rounded-xl p-6 mb-6 mx-auto max-w-2xl">
          <h2 class="text-xl font-bold text-blue-700 mb-2">ğŸ† ë‚˜ì˜ ë ˆë²¨</h2>
          <p id="xp-status" class="text-lg font-semibold"></p>
          <button id="levelShopBtn" class="text-sm bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
            ë ˆë²¨ ìƒì 
          </button>
          <!-- ë“±ê¸‰í‘œ ì—´ê¸°/ë‹«ê¸° ë²„íŠ¼ -->
          <div class="max-w-2xl mx-auto mt-6">
            <button id="toggle-levels" class="text-sm bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
              ğŸ“Š ì „ì²´ ë“±ê¸‰í‘œ ë³´ê¸°
            </button>

            <!-- ë“±ê¸‰í‘œ ì˜ì—­ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
            <div id="level-table" class="mt-4 hidden bg-white shadow rounded-lg p-6">
              <h2 class="text-xl font-bold mb-4">ë“±ê¸‰í‘œ</h2>
              <div class="overflow-x-auto">
                <table class="w-full text-sm text-left border border-gray-300 rounded">
                  <thead class="bg-blue-100 text-gray-800">
                    <tr>
                      <th class="px-4 py-2">ë ˆë²¨</th>
                      <th class="px-4 py-2">ì•„ì´ì½˜</th>
                      <th class="px-4 py-2">í•œê¸€ ì´ë¦„</th>
                      <th class="px-4 py-2">ì˜ë¬¸ ì´ë¦„</th>
                    </tr>
                  </thead>
                  <tbody class="text-gray-700">
                    <tr>
                      <td class="px-4 py-1">LV.1</td>
                      <td>ğŸŒ±</td>
                      <td>ì”¨ì•—</td>
                      <td>Beginner</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.2</td>
                      <td>ğŸª´</td>
                      <td>ì¤€ë¹„ì¤‘</td>
                      <td>Growing</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.3</td>
                      <td>ğŸŒ¼</td>
                      <td>ë°œì•„ì</td>
                      <td>Seedling</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.4</td>
                      <td>ğŸŒ¿</td>
                      <td>ìƒˆì‹¹</td>
                      <td>Sprout</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.5</td>
                      <td>ğŸ€</td>
                      <td>ìì‚¬ê·€</td>
                      <td>Leaf</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.6</td>
                      <td>â˜˜ï¸</td>
                      <td>ìŒì</td>
                      <td>Apprentice</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.7</td>
                      <td>âœ¨</td>
                      <td>ì´ˆë³´</td>
                      <td>Beginner+</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.8</td>
                      <td>ğŸ§©</td>
                      <td>ì…ë¬¸ì</td>
                      <td>Novice</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.9</td>
                      <td>ğŸ”§</td>
                      <td>ì—°ìŠµìƒ</td>
                      <td>Trainee</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.10</td>
                      <td>ğŸ’¡</td>
                      <td>ì‹¤ìŠµì</td>
                      <td>Practitioner</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.11</td>
                      <td>ğŸ’¬</td>
                      <td>ë°œí‘œì</td>
                      <td>Presenter</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.12</td>
                      <td>ğŸ§ </td>
                      <td>ì´í•´ì</td>
                      <td>Thinker</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.13</td>
                      <td>ğŸ“Š</td>
                      <td>ë¶„ì„ê°€</td>
                      <td>Analyst</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.14</td>
                      <td>ğŸ”¥</td>
                      <td>ìˆ™ë ¨ì</td>
                      <td>Advanced</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.15</td>
                      <td>âš™ï¸</td>
                      <td>ìë™í™” ì´ˆê¸‰</td>
                      <td>Automation Novice</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.16</td>
                      <td>ğŸ§¬</td>
                      <td>ì„¤ê³„ì</td>
                      <td>Architect</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.17</td>
                      <td>ğŸ§ª</td>
                      <td>ì‹¤í—˜ì</td>
                      <td>Experimenter</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.18</td>
                      <td>ğŸ§™</td>
                      <td>ë§ˆìŠ¤í„°</td>
                      <td>Master</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.19</td>
                      <td>ğŸ’¼</td>
                      <td>íŒ€ ë¦¬ë”</td>
                      <td>Team Leader</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.20</td>
                      <td>ğŸš€</td>
                      <td>í˜ì‹ ê°€</td>
                      <td>Innovator</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.21</td>
                      <td>ğŸ§©</td>
                      <td>í•´ê²°ì‚¬</td>
                      <td>Solver</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.22</td>
                      <td>ğŸ¯</td>
                      <td>ë¬¸ì œ ìŠ¤ë‚˜ì´í¼</td>
                      <td>Problem Sniper</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.23</td>
                      <td>ğŸ¦¾</td>
                      <td>ë¯¸ë˜ ì„¤ê³„ì</td>
                      <td>Visionary</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.24</td>
                      <td>ğŸ†</td>
                      <td>ì „ì„¤ì˜ ì½”ë”</td>
                      <td>Legend</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.25</td>
                      <td>ğŸ§ </td>
                      <td>ì¸ê³µì§€ëŠ¥ êµê´€</td>
                      <td>AI Instructor</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-1">LV.26</td>
                      <td>ğŸ‘‘</td>
                      <td>ì „ì„¤ì˜ ê°œë°œì</td>
                      <td>Grandmaster Developer</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

        </div>
        <!-- ë ˆë²¨ í‘œì‹œ + ë²„íŠ¼ -->
        <!-- ìƒì  ëª¨ë‹¬ -->
        <div id="levelShopModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
          <div class="bg-white w-full max-w-md mx-auto p-6 rounded-2xl shadow-xl animate-scaleIn">
            <h2 class="text-2xl font-bold text-blue-800 mb-4 text-center">ğŸ ë ˆë²¨ ìƒì </h2>
            <p class="text-sm text-gray-600 mb-6 text-center">XPë¥¼ ì‚¬ìš©í•´ ì§„ë„ë¥¼ í•´ê¸ˆí•˜ì„¸ìš”!</p>

            <div id="shop-items" class="space-y-3 max-h-96 overflow-y-auto"></div>
            <div id="user-shop-status" class="text-center text-sm text-gray-700 mt-6 leading-relaxed">
              ğŸ–ï¸ <strong><span id="shop-user-icon">ğŸŒ±</span> <span id="shop-user-name">-</span></strong> (ë“±ê¸‰: <span
                id="shop-user-grade">-</span>)<br>
              ğŸ“ˆ ë ˆë²¨: <span id="shop-user-level">LV.-</span><br>
              âš¡ ê²½í—˜ì¹˜: <span id="shop-user-xp">- XP</span>
            </div>




            <button id="closeShopBtn" class="mt-6 w-full bg-gray-300 hover:bg-gray-400 py-2 rounded text-sm">ë‹«ê¸°</button>
          </div>
        </div>
        <div class="bg-white shadow rounded-xl p-6 mb-6 mx-auto max-w-2xl">
          <h2 class="text-xl font-bold text-blue-700 mb-4">ğŸ† ë­í‚¹</h2>
          <ol id="ranking-list" class="list-decimal list-inside text-gray-700">

          </ol>
        </div>

        <!-- ì¼ì¼ í€˜ìŠ¤íŠ¸ -->
        <div class="bg-white shadow rounded-xl p-6 mb-6 mx-auto max-w-2xl">
          <h2 class="text-xl font-bold text-blue-700 mb-4">ğŸ—“ï¸ ì¼ì¼ í€˜ìŠ¤íŠ¸ (Beta)</h2>
          <ul id="quest-list" class="space-y-3"></ul>
        </div>




        <script>
          const shopItems = [
            { level: 1, xp: 50 },
            { level: 2, xp: 70 },
            { level: 3, xp: 100 },
            { level: 4, xp: 130 },
            { level: 5, xp: 160 },
            { level: 6, xp: 200 },
            { level: 7, xp: 240 },
            { level: 8, xp: 280 },
            { level: 9, xp: 320 },
            { level: 10, xp: 360 },
            { level: 11, xp: 400 },
            { level: 12, xp: 450 },
            { level: 13, xp: 500 },
            { level: 14, xp: 550 },
            { level: 15, xp: 600 },
            { level: 16, xp: 700 },
            { level: 17, xp: 800 },
          ];


          const shopContainer = document.getElementById("shop-items");

          shopItems.forEach((item, index) => {
            const requiredAttr = index === 0 ? '' : `data-required=\"unlock_set_${item.level - 1}\"`;
            const html = `
                  <div class=\"flex justify-between items-center bg-gray-50 border px-4 py-2 rounded-lg\">
                    <div class=\"text-left\">
                      <p class=\"text-sm font-medium\">${item.level}ë‹¨ê³„ ì§„ë„ ì—´ê¸°</p>
                      <p class=\"text-xs text-gray-500\">(Lv${item.level}, ${item.xp}XP)</p>
                    </div>
                    <button class=\"buy-btn text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded\"
                            data-key=\"unlock_set_${item.level}\"
                            ${requiredAttr}
                            data-cost=\"${item.xp}\">
                      êµ¬ë§¤
                    </button>
                  </div>
                `;
            shopContainer.insertAdjacentHTML("beforeend", html);
          });

          document.getElementById("closeShopBtn").addEventListener("click", () => {
            document.getElementById("levelShopModal").classList.add("hidden");
            document.getElementById("levelShopModal").classList.remove("flex");
          });

        </script>

        <script>
          document.getElementById("toggle-levels").addEventListener("click", () => {
            const table = document.getElementById("level-table");
            const btn = document.getElementById("toggle-levels");
            table.classList.toggle("hidden");
            btn.textContent = table.classList.contains("hidden")
              ? "ğŸ“Š ì „ì²´ ë“±ê¸‰í‘œ ë³´ê¸°"
              : "âŒ ë“±ê¸‰í‘œ ë‹«ê¸°";
          });
        </script>




        <div class="bg-white shadow rounded-xl p-6 mb-6 mx-auto max-w-2xl">
          <h2 class="text-xl font-bold text-blue-700 mb-2">ğŸ“ ë‚˜ë§Œì˜ ë©”ëª¨ì¥</h2>
          <textarea id="memo" placeholder="ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ì„ ì •ë¦¬í•´ ë³´ì„¸ìš”." class="w-full p-3 border rounded"></textarea>
        </div>
      </div>


      <div id="python" class="tab-content">
        <h2 class="text-2xl font-bold mb-4 text-blue-700">íŒŒì´ì¬ í•™ìŠµ</h2>
        <p>íŒŒì´ì¬ì˜ ê¸°ë³¸ ê°œë…ê³¼ ë‹¤ì–‘í•œ ë§í¬ë“¤ì„ í†µí•´ ì‹¤ìŠµì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <a href="print.html" class="button">print()</a>

        <div data-set="unlock_set_1" class="lesson-set hidden">
          <a href="python1.html" class="button">1-1. ê³„ì‚° ë°°ìš°ê¸°</a>
          <a href="python2.html" class="button">1-2. íƒ€ì… ë°°ìš°ê¸°</a>
          <a href="python3.html" class="button">1-3. ìˆ«ì ê³„ì‚°</a>
        </div>

        <div data-set="unlock_set_2" class="lesson-set hidden">
          <a href="python4.html" class="button">2-1. ë³€ìˆ˜ë€?</a>
          <a href="python2-2.html" class="button">2-2. ë³€ìˆ˜ ë‹¤ë£¨ê¸°</a>
          <a href="python2-3.html" class="button">2-3. ë³€ìˆ˜ì™€ ê³„ì‚°</a>
          <a href="python2-4.html" class="button">2-4. ê°’ ì…ë ¥ ë°›ê¸°</a>
          <a href="python2-5.html" class="button">2-5. ë‹¤ì–‘í•œ ì¶œë ¥</a>
          <a href="python2-6.html" class="button">2-6. ë³€ìˆ˜ ì˜ˆì œ</a>
        </div>

        <div data-set="unlock_set_3" class="lesson-set hidden">
          <a href="python3-1.html" class="button">3-1. ê°’ ì…ë ¥ ë°›ê¸°</a>
          <a href="python3-2.html" class="button">3-2. is, in, type</a>
          <a href="python3-3.html" class="button">3-3. bool ë³€í™˜</a>
          <a href="python3-4.html" class="button">3-4. ë…¼ë¦¬ ì—°ì‚°ì</a>
          <a href="python3-5.html" class="button">3-5. ë¹„êµí•˜ê¸° ì˜ˆì œ</a>
        </div>

        <div data-set="unlock_set_4" class="lesson-set hidden">
          <a href="python4-1.html" class="button">4-1. í•¨ìˆ˜ì˜ í˜¸ì¶œ</a>
          <a href="python4-2.html" class="button">4-2. í•¨ìˆ˜ì˜ ë°˜í™˜</a>
          <a href="python4-3.html" class="button">4-3. í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜
            <a href="python4-4.html" class="button">4-4. í•¨ìˆ˜ì˜ ì‚¬ìš©</a>
            <a href="python4-5.html" class="button">4-5. í•¨ìˆ˜ ì˜ˆì œ</a>
        </div>

        <div data-set="unlock_set_5" class="lesson-set hidden">
          <a href="python5-1.html" class="button">5-1. ë¬¸ìì—´ ì‚¬ìš©í•´ë³´ê¸°</a>
          <a href="python5-2.html" class="button">5-2. ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©í•´ë³´ê¸°</a>
          <a href="python5-3.html" class="button">5-3. íŠœí”Œ ì‚¬ìš©í•´ë³´ê¸°</a>
          <a href="python5-4.html" class="button">5-4. range ì‚¬ìš©í•´ë³´ê¸°</a>
          <a href="python5-5.html" class="button">5-5. ì‹œí€¸ì¦ˆ ìë£Œí˜•ì˜ ê¸°ë³¸</a>
          <a href="python5-6.html" class="button">5-6. ì‹œí€¸ì¦ˆ ìë£Œí˜• ì‚¬ìš©í•´ë³´ê¸°_ì˜ˆì œ</a>
        </div>

        <div data-set="unlock_set_6" class="lesson-set hidden">
          <a href="python6-1.html" class="button">6-1. if ì‚¬ìš©í•´ë³´ê¸°</a>
          <a href="python6-2.html" class="button">6-2. if í™œìš©í•´ë³´ê¸°</a>
          <a href="python6-3.html" class="button">6-3. else ì‚¬ìš©í•´ë³´ê¸°</a>
          <a href="python6-4.html" class="button">6-4. else ì™€ if ì¤‘ì²©</a>
          <a href="python6-5.html" class="button">6-5. elif ì‚¬ìš©í•´ë³´ê¸°</a>
          <a href="python6-6.html" class="button">6-6. ì¡°ê±´ë¬¸ ì‚¬ìš©í•´ë³´ê¸°_ì˜ˆì œ</a>
        </div>

        <div data-set="unlock_set_7" class="lesson-set hidden">
          <a href="python7-1.html" class="button">7-1. forë¬¸ì˜ ê¸°ë³¸</a>
          <a href="python7-2.html" class="button">7-2. forë¬¸ìœ¼ë¡œ ëˆ„ì  í‘œí˜„í•˜ê¸°</a>
          <a href="python7-3.html" class="button">7-3. whileë¬¸ì˜ ê¸°ë³¸</a>
          <a href="python7-4.html" class="button">7-4. breakì™€ continue</a>
          <a href="python7-5.html" class="button">7-5. í•œê¸€ ì½”ë“œ ì‚¬ìš©í•˜ê¸°</a>
          <a href="python7-6.html" class="button">7-6. ë°˜ë³µë¬¸ ì‚¬ìš©í•˜ê¸° ì˜ˆì œ1</a>
          <a href="python7-7.html" class="button">7-7. ë°˜ë³µë¬¸ ì‚¬ìš©í•˜ê¸° ì˜ˆì œ2</a>
        </div>
        <div data-set="unlock_set_8" class="lesson-set hidden">
          <a href="python8-1.html" class="button">8-1. ìŠ¬ë¼ì´ìŠ¤ ì‚¬ìš©í•˜ê¸°</a>
          <a href="python8-2.html" class="button">8-2. ìŠ¬ë¼ì´ìŠ¤ ì‘ìš©í•˜ê¸°</a>
          <a href="python8-3.html" class="button">8-3. ì‹œí€€ìŠ¤ì—ì„œ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ë“¤</a>
          <a href="python8-4.html" class="button">8-4. ì •ë ¬ í•¨ìˆ˜</a>
          <a href="python8-5.html" class="button">8-5. List Comprehension ê¸°ë³¸</a>
          <a href="python8-6.html" class="button">8-6. List Comprehension ì¡°ê±´ í•„í„°</a>
          <a href="python8-7.html" class="button">8-7. List Comprehension ì‘ìš©</a>
          <a href="python8-8.html" class="button">8-8. ì‹œí€€ìŠ¤ í™œìš©í•˜ê¸° ì˜ˆì œ</a>
        </div>

        <div data-set="unlock_set_9" class="lesson-set hidden">
          <a href="python9-1.html" class="button">9-1. ë¬¸ìì—´ ê¸°ì´ˆ</a>
          <a href="python9-2.html" class="button">9-2. ë¬¸ìì—´ í¬ë§·íŒ…</a>
          <a href="python9-3.html" class="button">9-3. ë¬¸ìì—´ ë©”ì„œë“œ (ë¬¸ì ë³€ê²½)</a>
          <a href="python9-4.html" class="button">9-4. ë¬¸ìì—´ ë©”ì„œë“œ (ê²€ìƒ‰)</a>
        </div>

        <div data-set="unlock_set_10" class="lesson-set hidden">
          <a href="python10-1.html" class="button">10-1. ìš”ì†Œë¥¼ ì¶”ê°€í•˜ëŠ” ë©”ì„œë“œ</a>
          <a href="python10-2.html" class="button">10-2. ìš”ì†Œë¥¼ ì œê±°í•˜ëŠ” ë©”ì„œë“œ</a>
          <a href="python10-3.html" class="button">10-3. ìš”ì†Œë¥¼ ì°¾ê³  ì •ë ¬í•˜ëŠ” ë©”ì„œë“œ</a>
        </div>

        <div data-set="unlock_set_11" class="lesson-set hidden">
          <a href="python11-1.html" class="button">11-1. ë‚˜ë¨¸ì§€ ë©”ì„œë“œ</a>
          <a href="python11-2.html" class="button">11-2. ì°¸ì¡°</a>
          <a href="python11-3.html" class="button">11-3. ì• ìŠ¤í„°ë¦¬ìŠ¤í¬</a>
          <a href="python11-4.html" class="button">11-4. sortë¥¼ ìœ„í•œ í•¨ìˆ˜ ë§Œë“¤ê¸°</a>
        </div>

        <div data-set="unlock_set_12" class="lesson-set hidden">
          <a href="python12-1.html" class="button">12-1. ë°˜ë³µë¬¸ ì•ˆì— ë°˜ë³µë¬¸</a>
          <a href="python12-2.html" class="button">12-2. ë¦¬ìŠ¤íŠ¸ ì•ˆì— ë¦¬ìŠ¤íŠ¸</a>
          <a href="python12-3.html" class="button">12-3. List Comprehension ì¤‘ì²©</a>
          <a href="python12-4.html" class="button">12-4. ë¦¬ìŠ¤íŠ¸ ì°¸ì¡°</a>
          <a href="python12-5.html" class="button">12-5. ì¬ê·€í•¨ìˆ˜</a>
        </div>

        <div data-set="unlock_set_13" class="lesson-set hidden">
          <a href="python13-1.html" class="button">13-1. setì˜ ê°œë…ê³¼ ì—°ì‚°</a>
          <a href="python13-2.html" class="button">13-2. setì˜ ì‘ìš©</a>
          <a href="python13-3.html" class="button">13-3. dictionaryì˜ ê°œë…ê³¼ ì—°ì‚°</a>
          <a href="python13-4.html" class="button">13-4. dictionaryì˜ ì‘ìš©</a>
        </div>

        <div data-set="unlock_set_14" class="lesson-set hidden">
          <a href="python14-1.html" class="button">14-1. importì— ëŒ€í•´ì„œ</a>
          <a href="python14-2.html" class="button">14-2. math</a>
          <a href="python14-3.html" class="button">14-3. random</a>
          <a href="python14-4.html" class="button">14-4. time</a>
          <a href="python14-5.html" class="button">14-5. datetime.timedelta</a>
          <a href="python14-6.html" class="button">14-6. datetime.date</a>
          <a href="python14-7.html" class="button">14-7. datetime.datetime</a>
        </div>

        <div data-set="unlock_set_15" class="lesson-set hidden">
          <a href="python15-1.html" class="button">15-1. ë¬´í•œ ë°˜ë³µ ëª¨ë“ˆ</a>
          <a href="python15-2.html" class="button">15-2. ë‹¤ì–‘í•œ ë°˜ë³µì ëª¨ë“ˆ</a>
          <a href="python15-3.html" class="button">15-3. ì¡°í•©í˜• ëª¨ë“ˆ</a>
          <a href="python15-4.html" class="button">15-4. ì¡°í•©í˜• ëª¨ë“ˆ ì‘ìš©</a>
        </div>

        <div data-set="unlock_set_16" class="lesson-set hidden">
          <a href="python16-1.html" class="button">16-1. í´ë˜ìŠ¤ ê¸°ì´ˆ</a>
          <a href="python16-2.html" class="button">16-2. Python Advanced Syntax</a>
          <a href="python16-3.html" class="button">16-3. í´ë˜ìŠ¤ ì˜ˆì œ</a>
        </div>

        <div data-set="unlock_set_17" class="lesson-set hidden">
          <a href="python17-1.html" class="button">17-1. ì—°ì‚°ì ìš°ì„ ìˆœìœ„</a>
          <a href="python17-3.html" class="button">17-3. ë§¤ì§ ë©”ì„œë“œ ë¦¬ìŠ¤íŠ¸</a>
        </div>
      </div>
      <div id="quiz" class="tab-content">
        <h2 class="text-2xl font-bold mb-4 text-blue-700">íŒŒì´ì¬ ë¬¸ì œ</h2>


        <a href="python.hw1.html" class="button">print. ë‹¤ì´ì•„ëª¬ë“œ ì¶œë ¥</a>


        <div data-set="unlock_set_1" class="lesson-set hidden">
          <a href="python.hw2-1.html" class="button">1-1. ëª«ê³¼ ë‚˜ë¨¸ì§€</a>
          <a href="python.hw2-2.html" class="button">1-2. ì œê³± ê³„ì‚°í•˜ê¸°</a>
          <a href="python.hw2-3.html" class="button">1-3. ì›ê°€ì™€ ì •ê°€</a>
          <a href="python.hw2-4.html" class="button">1-4. ì†Œê¸ˆë¬¼ ë†ë„ êµ¬í•˜ê¸°</a>
          <a href="python.hw2-5.html" class="button">1-5. ì†Œê¸ˆë¬¼ ë†ë„ êµ¬í•˜ê¸° 2</a>
          <a href="python.hw2-6.html" class="button">1-6. í‰ê·  ì†ë ¥ êµ¬í•˜ê¸°</a>
          <a href="python.hw2-7.html" class="button">1-7. ë§ì•„í†¤ ê¿ˆì˜ ê¸°ë¡</a>
        </div>

        <div data-set="unlock_set_2" class="lesson-set hidden">
          <a href="python.hw2.1-1.html" class="button">2-1. ë‘ìˆ˜ì˜ í•©</a>
          <a href="python.hw2.1-2.html" class="button">2-2. ë‘ìˆ˜ì˜ ì°¨</a>
          <a href="python.hw2.1-3.html" class="button">2-3. ë‘ìˆ˜ì˜ ê³±</a>
          <a href="python.hw2.1-4.html" class="button">2-4. ëª« êµ¬í•˜ê¸°</a>
          <a href="python.hw2.1-5.html" class="button">2-5. ë‚˜ë¨¸ì§€ êµ¬í•˜ê¸°</a>
          <a href="python.hw2.1-6.html" class="button">2-6. ë‚˜ì´ ê³„ì‚°</a>
          <a href="python.hw2.1-7.html" class="button">2-7. ë‘ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ</a>
          <a href="python.hw2.1-8.html" class="button">2-8. íŠ¹ìˆ˜ë¬¸ì ì¶œë ¥í•˜ê¸°</a>
          <a href="python.hw2.1-9.html" class="button">2-9. ì •ìˆ˜ ë¶€ë¶„ ì¶œë ¥í•˜ê¸°</a>
          <a href="python.hw2.1-10.html" class="button">2-10. ë¬¸ìì—´ ë¶™ì—¬ì„œ ì¶œë ¥í•˜ê¸°</a>
          <a href="python.hw2.1-11.html" class="button">2-11. ë§ì…ˆì‹ ì¶œë ¥í•˜ê¸°</a>
          <a href="python.hw2.1-12.html" class="button">2-12. aì™€ b ì¶œë ¥í•˜ê¸°</a>

        </div>

        <div data-set="unlock_set_3" class="lesson-set hidden">
          <a href="python.hw3-1.html" class="button">3-1. ë‘ìˆ˜ì˜ í•©</a>
          <a href="python.hw3-2.html" class="button">3-2. ë‘ìˆ˜ì˜ ì°¨</a>
          <a href="python.hw3-3.html" class="button">3-3. ë‘ìˆ˜ì˜ ê³±</a>
          <a href="python.hw3-4.html" class="button">3-4. ëª« êµ¬í•˜ê¸°</a>
          <a href="python.hw3-5.html" class="button">3-5. ë‚˜ë¨¸ì§€ êµ¬í•˜ê¸°</a>
          <a href="python.hw3-6.html" class="button">3-6. ë‚˜ì´ ê³„ì‚°</a>
          <a href="python.hw3-7.html" class="button">3-7. ë‘ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ</a>
          <a href="python.hw3-8.html" class="button">3-8. íŠ¹ìˆ˜ë¬¸ì ì¶œë ¥í•˜ê¸°</a>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="script.js"></script>
  <script src="local-script.js"></script>



  <script>
    let purchasedItems = new Set();

    // êµ¬ë§¤í•œ í•­ëª© ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadPurchasedItems() {
      const userId = localStorage.getItem("userId");
      if (!userId) return;

      const { data, error } = await supabase
        .from("club_xp_items")
        .select("item_key")
        .eq("user_id", userId);

      if (error) {
        console.error("âŒ êµ¬ë§¤ ê¸°ë¡ ì¡°íšŒ ì‹¤íŒ¨:", error.message);
        return;
      }

      purchasedItems = new Set(data.map(d => d.item_key));
      updateBuyButtons();
      updateLessonVisibility(); // ì—¬ê¸°ì„œ ì§„ë„ ë²„íŠ¼ì„ ë³´ì´ê²Œ ë§Œë“¦
    }
    window.loadPurchasedItems = loadPurchasedItems;

    function updateLessonVisibility() {
      const allSets = Array.from(document.querySelectorAll(".lesson-set"));
      let foundNext = false;

      allSets.forEach(setEl => {
        const requiredKey = setEl.dataset.set;
        const unlocked = purchasedItems.has(requiredKey);

        // ê¸°ë³¸ ìƒíƒœ: ìˆ¨ê¹€
        setEl.classList.add("hidden");
        setEl.classList.remove("locked-preview");

        if (unlocked) {
          setEl.classList.remove("hidden");
        }
        // êµ¬ë§¤í•˜ì§€ ì•Šì€ ì§„ë„ëŠ” ìˆ¨ê¹€ ìœ ì§€

      });
    }



    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateBuyButtons() {
      document.querySelectorAll(".buy-btn").forEach(btn => {
        const key = btn.dataset.key;
        const requiredKey = btn.dataset.required;
        const cost = parseInt(btn.dataset.cost);
        const alreadyPurchased = purchasedItems.has(key);
        const requiredPurchased = !requiredKey || purchasedItems.has(requiredKey);

        const disabled = !requiredPurchased || window.currentXP < cost || alreadyPurchased;

        btn.disabled = disabled;
        btn.classList.toggle("opacity-50", disabled);
        btn.innerText = alreadyPurchased ? "êµ¬ë§¤ ì™„ë£Œ" : "êµ¬ë§¤";
      });
    }


    // êµ¬ë§¤ ì²˜ë¦¬
    document.querySelectorAll(".buy-btn").forEach(btn => {
      btn.addEventListener("click", async () => {
        const key = btn.dataset.key;
        const cost = parseInt(btn.dataset.cost);
        const userId = localStorage.getItem("userId");

        if (purchasedItems.has(key)) {
          alert("â— ì´ë¯¸ êµ¬ë§¤í•œ ì•„ì´í…œì…ë‹ˆë‹¤.");
          return;
        }

        const { data } = await supabase
          .from("club_xp")
          .select("*")
          .eq("user_id", userId)
          .eq("club_name", "ì½”ë”©ë™ì•„ë¦¬");

        if (data.length > 0) {
          const current = data[0].xp;
          const newXP = current - cost;

          await supabase
            .from("club_xp")
            .update({ xp: newXP })
            .eq("id", data[0].id);

          await supabase
            .from("club_xp_items")
            .insert([{ user_id: userId, item_key: key, purchased: true }]);

          await updateXp(userId);     // XP UI ê°±ì‹ 
          await loadPurchasedItems(); // ë²„íŠ¼ ë‹¤ì‹œ ì²´í¬
          alert("âœ… ì•„ì´í…œì„ ì„±ê³µì ìœ¼ë¡œ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!");
        }
      });
    });

    // ìƒì  ì—´ë¦´ ë•Œ ì‹¤í–‰
    document.getElementById("levelShopBtn").addEventListener("click", async () => {
      document.getElementById("levelShopModal").classList.remove("hidden");
      document.getElementById("levelShopModal").classList.add("flex");
      await loadPurchasedItems();
      await loadShopUserStatus();  // âœ… ì‚¬ìš©ì ìƒíƒœ í‘œì‹œ
    });
    async function loadShopUserStatus() {
      const userId = localStorage.getItem("userId");
      if (!userId) return;

      // ì‚¬ìš©ì XP ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const { data, error } = await supabase
        .from('club_xp')
        .select('*')
        .eq('user_id', userId)
        .eq('club_name', 'ì½”ë”©ë™ì•„ë¦¬')
        .limit(1);

      if (error || !data || data.length === 0) {
        console.error("âŒ ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
        return;
      }

      const info = data[0];

      document.getElementById("shop-user-level").textContent = `LV.${info.level}`;
      document.getElementById("shop-user-xp").textContent = `${info.xp} XP`;
      document.getElementById("shop-user-name").textContent = info.name || userId;
      document.getElementById("shop-user-grade").textContent = info.grade || "-";
      document.getElementById("shop-user-icon").textContent = info.icon || "ğŸ–ï¸";
    }

  </script>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://jzkqqqofveivqaerqwcl.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6a3FxcW9mdmVpdnFhZXJxd2NsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY5NjEwMzQsImV4cCI6MjA2MjUzNzAzNH0.PYB6fyfyAxaZBK76kUnPe5d7EQKWXfCBBIlvdNPwyq0'
    );

    async function checkAttendance(userId) {
      const today = new Date().toISOString().split('T')[0];

      // ì´ë¯¸ ì¶œì„í–ˆëŠ”ì§€ í™•ì¸
      const { data: existing } = await supabase
        .from('club_attendance')
        .select('*')
        .eq('user_id', userId)
        .eq('club_name', 'ì½”ë”©ë™ì•„ë¦¬')
        .eq('date', today);

      if (existing.length > 0) {
        document.getElementById("attendance-status").textContent = `âœ… ì´ë¯¸ ì˜¤ëŠ˜(${today}) ì¶œì„ ì™„ë£Œ`;
        return;
      }

      // ë§ˆì§€ë§‰ ì¶œì„ì¼ í™•ì¸
      const { data: last } = await supabase
        .from('club_attendance')
        .select('date, consecutive_days')
        .eq('user_id', userId)
        .eq('club_name', 'ì½”ë”©ë™ì•„ë¦¬')
        .order('date', { ascending: false })
        .limit(1);

      let streak = 1;
      if (last.length > 0) {
        const lastDate = new Date(last[0].date);
        const diff = (new Date(today) - lastDate) / (1000 * 60 * 60 * 24);
        streak = diff === 1 ? last[0].consecutive_days + 1 : 1;
      }

      // ì¶œì„ ê¸°ë¡ ì¶”ê°€
      await supabase.from('club_attendance').insert([
        {
          user_id: userId,
          club_name: 'ì½”ë”©ë™ì•„ë¦¬',
          date: today,
          consecutive_days: streak
        }
      ]);


      // XP ë³´ìƒ
      const xp = 10 + (streak >= 2 ? 20 : 0); // ê¸°ë³¸ 10XP + ì—°ì† ë³´ë„ˆìŠ¤
      await addXP(xp);
      scrollToCalendar(); // (ì„ íƒ) ë‹¬ë ¥ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤

      await processDailyQuests(userId); // âœ… ì¶œì„ í›„ í€˜ìŠ¤íŠ¸ ìë™ ì„±ê³µ ì²´í¬
      document.getElementById("attendance-status").textContent =
        `ğŸ‰ ì¶œì„ ì™„ë£Œ! ${xp} XP ì§€ê¸‰ (ì—°ì† ${streak}ì¼ì°¨)`;

      // ë‹¬ë ¥ í‘œì‹œ
      document.getElementById("calendar-container").classList.remove("hidden");
      await renderCalendar(userId);


    }

    async function assignDailyQuests(userId) {
      const today = new Date().toISOString().split('T')[0];

      // ì´ë¯¸ ì˜¤ëŠ˜ í€˜ìŠ¤íŠ¸ë¥¼ ë°›ì€ ê²½ìš° í•¨ìˆ˜ ì¢…ë£Œ
      const { data: existing } = await supabase
        .from('user_daily_quests')
        .select('quest_id')
        .eq('user_id', userId)
        .eq('date', today);

      if (existing && existing.length >= 3) {
        console.log("âœ… ì˜¤ëŠ˜ í€˜ìŠ¤íŠ¸ ì´ë¯¸ ë°°ì •ë¨");
        return;
      }

      // ì „ì²´ í€˜ìŠ¤íŠ¸ ëª©ë¡ì—ì„œ ë¬´ì‘ìœ„ë¡œ 3ê°œ ì„ íƒ
      const { data: allQuests } = await supabase.from('daily_quests').select('*');
      if (!allQuests || allQuests.length < 3) {
        console.warn("âš ï¸ í€˜ìŠ¤íŠ¸ ëª©ë¡ ë¶€ì¡±");
        return;
      }

      const selected = allQuests.sort(() => 0.5 - Math.random()).slice(0, 3);
      const inserts = selected.map(q => ({
        user_id: userId,
        date: today,
        quest_id: q.id
      }));

      await supabase.from('user_daily_quests').insert(inserts);
      console.log("ğŸ¯ í€˜ìŠ¤íŠ¸ 3ê°œ ë°°ì • ì™„ë£Œ");
    }
    document.addEventListener("DOMContentLoaded", async () => {
      const userId = localStorage.getItem("userId");
      await assignDailyQuests(userId);     // í€˜ìŠ¤íŠ¸ ë¬´ì‘ìœ„ í• ë‹¹
      await loadDailyQuests(userId);       // í€˜ìŠ¤íŠ¸ UI í‘œì‹œ
      await processDailyQuests(userId);    // í€˜ìŠ¤íŠ¸ ìë™ í™•ì¸
    });

    async function processDailyQuests(userId) {
      if (!userId) return;

      const today = new Date().toISOString().split('T')[0];

      // ì˜¤ëŠ˜ ë¬´ì‘ìœ„ë¡œ ë¶€ì—¬ëœ í€˜ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
      const { data: todayQuests, error: err1 } = await supabase
        .from('user_daily_quests')
        .select('quest_id')
        .eq('user_id', userId)
        .eq('date', today);

      if (err1) {
        console.error("âŒ í€˜ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err1.message);
        return;
      }

      if (!todayQuests || todayQuests.length === 0) {
        console.log("âš ï¸ ì˜¤ëŠ˜ í€˜ìŠ¤íŠ¸ ì—†ìŒ");
        return;
      }

      const questIds = todayQuests.map(q => q.quest_id).slice(0, 3); // ìµœëŒ€ 3ê°œë§Œ

      // í€˜ìŠ¤íŠ¸ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const { data: quests, error: err2 } = await supabase
        .from('daily_quests')
        .select('*')
        .in('id', questIds);

      if (err2 || !quests) {
        console.error("âŒ í€˜ìŠ¤íŠ¸ ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:", err2?.message);
        return;
      }

      // ì˜¤ëŠ˜ ì™„ë£Œí•œ í€˜ìŠ¤íŠ¸ ì¡°íšŒ
      async function processDailyQuests(userId) {
        if (!userId) return;

        const today = new Date().toISOString().split('T')[0];

        // ì˜¤ëŠ˜ í€˜ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
        const { data: todayQuests, error: err1 } = await supabase
          .from('user_daily_quests')
          .select('quest_id')
          .eq('user_id', userId)
          .eq('date', today);

        if (err1 || !todayQuests) return;

        const questIds = todayQuests.map(q => q.quest_id);

        const { data: quests } = await supabase
          .from('daily_quests')
          .select('*')
          .in('id', questIds);

        const { data: completedLog } = await supabase
          .from('user_quest_log')
          .select('quest_id')
          .eq('user_id', userId)
          .eq('date', today);

        const completedIds = completedLog?.map(q => q.quest_id) || [];

        for (const quest of quests) {
          if (completedIds.includes(quest.id)) continue;

          let success = false;

          if (quest.title.includes("ì¶œì„")) {
            const { data: attendance } = await supabase
              .from('club_attendance')
              .select('id')
              .eq('user_id', userId)
              .eq('date', today);
            success = attendance?.length > 0;
          }

          if (quest.title.includes("ë©”ëª¨")) {
            const { data: memo } = await supabase
              .from('club_memo')
              .select('content')
              .eq('user_id', userId);
            success = memo && memo[0]?.content?.length >= 5;
          }

          if (success) {
            const reward = XP_BY_DIFFICULTY[quest.difficulty] || 10;
            await addXP(reward);

            await supabase.from('user_quest_log').insert([{
              user_id: userId,
              quest_id: quest.id,
              date: today,
              completed: true,
              completed_at: new Date().toISOString()
            }]);

            console.log(`âœ… í€˜ìŠ¤íŠ¸ ì™„ë£Œ ì²˜ë¦¬ë¨: ${quest.title} (+${reward}XP)`);
          }
        }
      }
    }




    const XP_BY_DIFFICULTY = {
      'í•˜': 10,
      'ì¤‘': 20,
      'ìƒ': 30
    };


    async function renderCalendar(userId) {
      const { data, error } = await supabase
        .from('club_attendance')
        .select('date')
        .eq('user_id', userId)
        .eq('club_name', 'ì½”ë”©ë™ì•„ë¦¬');

      if (error) {
        console.error("âŒ ì¶œì„ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error.message);
        return;
      }

      // ì¶œì„ ë‚ ì§œë¥¼ í•œêµ­ ì‹œê°„ ê¸°ì¤€ YYYY-MM-DD í¬ë§·ìœ¼ë¡œ ì •ë¦¬
      const attendanceDates = new Set(
        data.map(d => {
          const date = new Date(d.date + "T00:00:00");
          return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        })
      );

      const calendarGrid = document.getElementById("calendar-grid");
      calendarGrid.innerHTML = ""; // ì´ˆê¸°í™”

      const weekdays = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
      weekdays.forEach(day => {
        const div = document.createElement("div");
        div.textContent = day;
        calendarGrid.appendChild(div);
      });

      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();
      const startDay = new Date(year, month, 1).getDay();
      const lastDate = new Date(year, month + 1, 0).getDate();

      // ë¹ˆì¹¸ ì¶œë ¥ (1ì¼ ì „ê¹Œì§€)
      for (let i = 0; i < startDay; i++) {
        calendarGrid.appendChild(document.createElement("div"));
      }

      // ë‚ ì§œ ì¶œë ¥
      for (let d = 1; d <= lastDate; d++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
        const isMarked = attendanceDates.has(dateStr);

        const div = document.createElement("div");
        div.textContent = d;
        div.className = "p-2 text-sm text-center rounded";

        if (isMarked) {
          div.classList.add("bg-green-500", "text-white", "font-bold");
        } else {
          div.classList.add("bg-gray-100");
        }

        calendarGrid.appendChild(div);
      }
    }





    document.addEventListener("DOMContentLoaded", async () => {
      const userId = localStorage.getItem("userId"); // âœ… ë¨¼ì € ê°€ì ¸ì˜¤ê¸°
      await loadRanking();
      await loadMemo();
      await loadDailyQuests(userId);
    });




    async function loadDailyQuests(userId) {
      const today = new Date().toISOString().split('T')[0];

      // ì˜¤ëŠ˜ì˜ í€˜ìŠ¤íŠ¸ 3ê°œ ë¶ˆëŸ¬ì˜¤ê¸°
      const { data: todayQuests } = await supabase
        .from('user_daily_quests')
        .select('quest_id')
        .eq('user_id', userId)
        .eq('date', today);

      if (!todayQuests) return;

      const ids = todayQuests.map(q => q.quest_id);

      const { data: quests, error } = await supabase
        .from('daily_quests')
        .select('*')
        .in('id', ids);

      if (error) {
        console.error("âŒ í€˜ìŠ¤íŠ¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error.message);
        return;
      }

      // âœ… ì™„ë£Œëœ í€˜ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
      const { data: completedLog } = await supabase
        .from('user_quest_log')
        .select('quest_id')
        .eq('user_id', userId)
        .eq('date', today);

      const completedIds = completedLog?.map(q => q.quest_id) || [];

      const list = document.getElementById("quest-list");
      list.innerHTML = "";

      quests.forEach(q => {
        const isCompleted = completedIds.includes(q.id);
        const reward = XP_BY_DIFFICULTY[q.difficulty] || 10;

        const li = document.createElement("li");
        li.innerHTML = `
      <div class="flex justify-between items-center border p-3 rounded ${isCompleted ? 'bg-green-100' : 'bg-gray-50'}">
        <span>ğŸ“Œ ${q.title} (${q.difficulty}) ${isCompleted ? 'âœ… ì™„ë£Œ' : ''}</span>
        <span class="text-sm ${isCompleted ? 'text-green-700 font-bold' : 'text-blue-600'}">
          ${isCompleted ? `+${reward} XP` : `+${reward} XP`}
        </span>
      </div>
    `;
        list.appendChild(li);
      });
    }

    window.checkAttendance = checkAttendance;
    window.renderCalendar = renderCalendar;

    async function fetchRanking() {
      const { data, error } = await supabase
        .from('club_xp')
        .select('user_id, xp')
        .eq('club_name', 'ì½”ë”©ë™ì•„ë¦¬')
        .order('xp', { ascending: false })
        .limit(100);

      if (error) {
        console.error('ë­í‚¹ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:', error.message);
        return;
      }

      displayRanking(data);
    }

    function displayRanking(data) {
      const rankingContainer = document.getElementById('ranking-container');
      rankingContainer.innerHTML = '';

      data.forEach((user, index) => {
        const rankItem = document.createElement('div');
        rankItem.className = 'flex justify-between p-2 border-b';
        rankItem.innerHTML = `
      <span>${index + 1}ìœ„</span>
      <span>${user.user_id}</span>
      <span>${user.xp} XP</span>
    `;
        rankingContainer.appendChild(rankItem);
      });
    }

    async function loadRanking() {
      const { data, error } = await supabase
        .from('club_xp')
        .select('user_id, xp')
        .eq('club_name', 'ì½”ë”©ë™ì•„ë¦¬')
        .order('xp', { ascending: false });

      if (error) {
        console.error('âŒ ë­í‚¹ ì¡°íšŒ ì‹¤íŒ¨:', error.message);
        return;
      }

      const rankingList = document.getElementById('ranking-list');
      rankingList.innerHTML = "";

      data.forEach((entry, index) => {
        const li = document.createElement('li');
        let prefix = "";
        let style = "";

        if (index === 0) {
          prefix = "ğŸ‘‘ Admin";
          style = "text-red-600";
        } else {
          const rank = index; // Adminì„ 0ë²ˆìœ¼ë¡œ í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” 1ë¶€í„° ì‹œì‘
          switch (rank) {
            case 1:
              prefix = "ğŸ¥‡ 1ìœ„";
              style = "text-yellow-600 font-bold";
              break;
            case 2:
              prefix = "ğŸ¥ˆ 2ìœ„";
              style = "text-gray-700";
              break;
            case 3:
              prefix = "ğŸ¥‰ 3ìœ„";
              style = "text-orange-600";
              break;
            default:
              prefix = `ğŸ˜¢ ${rank}ìœ„`;
              style = "text-gray-500 text-sm";
          }
        }

        li.innerHTML = `<span class="${style}">${prefix} - ${entry.user_id} (${entry.xp} XP)</span>`;
        rankingList.appendChild(li);
      });
    }


    document.addEventListener("DOMContentLoaded", loadRanking);

    let memoTimer;
    document.getElementById("memo").addEventListener("input", () => {
      clearTimeout(memoTimer);
      memoTimer = setTimeout(saveMemo, 5000); // 5ì´ˆ í›„ ìë™ ì €ì¥
    });

    async function saveMemo() {
      const content = document.getElementById("memo").value;
      const userId = localStorage.getItem("userId");
      if (!userId) return;

      const { data: existing } = await supabase
        .from('club_memo')
        .select('*')
        .eq('user_id', userId)
        .eq('club_name', 'ì½”ë”©ë™ì•„ë¦¬')
        .limit(1);

      if (existing.length > 0) {
        await supabase
          .from('club_memo')
          .update({ content, updated_at: new Date().toISOString() })
          .eq('id', existing[0].id);
      } else {
        await supabase
          .from('club_memo')
          .insert([{ user_id: userId, club_name: 'ì½”ë”©ë™ì•„ë¦¬', content }]);
      }

      console.log("ğŸ“ ë©”ëª¨ ì €ì¥ ì™„ë£Œ");
      await processDailyQuests(userId); // âœ… ë©”ëª¨ ì €ì¥ í›„ í€˜ìŠ¤íŠ¸ ìë™ í™•ì¸

    }

    async function loadMemo() {
      const userId = localStorage.getItem("userId");
      if (!userId) return;

      const { data, error } = await supabase
        .from('club_memo')
        .select('content')
        .eq('user_id', userId)
        .eq('club_name', 'ì½”ë”©ë™ì•„ë¦¬')
        .limit(1);

      if (error) {
        console.error("âŒ ë©”ëª¨ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error.message);
        return;
      }

      if (data.length > 0 && data[0].content) {
        document.getElementById("memo").value = data[0].content;
      }
    }

  </script>

  <!-- body íƒœê·¸ ë‚´ ê°€ì¥ ì•„ë˜ì— ì‚½ì… -->
<!-- ğŸ”ˆ ë°°ê²½ ìŒì•… ì œì–´ ì˜ì—­ -->
<div class="fixed bottom-4 left-4 bg-white p-4 rounded-xl shadow-lg flex flex-col gap-2 z-50 text-sm">
  <p class="font-semibold text-blue-600">ğŸ§ ë°°ê²½ ìŒì•…</p>
  <div class="flex gap-2 items-center">
    <button onclick="togglePlay()" id="playBtn" class="bg-blue-500 text-white px-3 py-1 rounded">â¸ï¸ ì¼ì‹œì •ì§€</button>
    <button onclick="nextTrack()" class="bg-indigo-500 text-white px-3 py-1 rounded">ğŸµ ìŒì•… ë°”ê¾¸ê¸°</button>
  </div>
  <input type="range" min="0" max="1" step="0.01" value="0.5" onchange="setVolume(this.value)" class="w-full" />
</div>

<!-- ğŸ¶ ì˜¤ë””ì˜¤ ìš”ì†Œ -->
<audio id="bgm" autoplay loop></audio>

<script>
  // ğŸµ ë°°ê²½ ìŒì•… ëª©ë¡ (ì›í•˜ì‹œëŠ” Suno ìŒì•… URLë¡œ êµì²´ ê°€ëŠ¥)
  const tracks = [
    "ë™ì•„ë¦¬bgm1.mp3",
    "ë™ì•„ë¦¬bgm2.m4a"
  ];

  let currentTrackIndex = 0;
  const audio = document.getElementById("bgm");
  const playBtn = document.getElementById("playBtn");

  // ì´ˆê¸°í™”
  audio.src = tracks[currentTrackIndex];
  audio.volume = 0.5;

  function togglePlay() {
    if (audio.paused) {
      audio.play();
      playBtn.textContent = "â¸ï¸ ì¼ì‹œì •ì§€";
    } else {
      audio.pause();
      playBtn.textContent = "â–¶ï¸ ë‹¤ì‹œ ì¬ìƒ";
    }
  }

  function setVolume(vol) {
    audio.volume = vol;
  }

  function nextTrack() {
    currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
    audio.src = tracks[currentTrackIndex];
    audio.play();
    playBtn.textContent = "â¸ï¸ ì¼ì‹œì •ì§€";
  }
</script>

</body>

</html>